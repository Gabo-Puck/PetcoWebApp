<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Swiper demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" , href="/stylesheets/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>


    <script src="https://code.jquery.com/jquery-3.6.0.slim.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js">
    </script>

    <!-- Demo styles -->
    <style>
        button, input[type="submit"], input[type="reset"] {
	background: none;
	color: inherit;
	border: none;
	padding: 0;
	font: inherit;
	cursor: pointer;
	outline: inherit;
}
        .swiper-slide {
            background-position: center;
            background-size: cover;
        }

        .swiper-slide img {
            display: block;
            width: 100%;
        }

        ul {
            transform: rotate(180deg);
        }

        ul>li {
            transform: rotate(-180deg);
        }
    </style>


</head>

<body>

    <div class="container mt-5" style="border:1px solid #cecece; text-align:center ;">
        <h1 class="mt-2 text-primary ">
            <%= MascotaRender[0].MascotasPublicacion.Titulo %>
        </h1>
        <h3>
            <%= MascotaRender[0].MascotasPublicacion.Descripcion %>
        </h3>
    </div>

    <div class=" container mr-5 ml-5" style=" text-align: center; ">

        <div class="swiper SliderMascota">

            <div class="swiper-wrapper">


                <% for(var i=0; i < MascotaRender.length; i++) { %>

                    
                    <div class="swiper-slide">
                        
                        <div class="row">
                            


                            <div class="col" style="border:1px solid #cecece;">

                                

                                <div class="swiper mySwiper mt-5" style="height: 300px; width: 300px;">
                                    <div class="swiper-wrapper">

                                        <% for(var j=0; j < MascotaRender[i].MascotasImagenes.length; j++) { %>

                                            <div class="swiper-slide">
                                                <img src="<%= MascotaRender[i].MascotasImagenes[j].Ruta%>"
                                                    style="height: 300px; width: 300px; object-fit: cover ;">
                                            </div>

                                            <% } %>

                                    </div>
                                    <div class="swiper-pagination"></div>
                                    <div class="swiper-button-next"></div>
                                    <div class="swiper-button-prev"></div>
                                </div>

                                <% if(MascotaRender[i].MascotasMetas !=null){ %>
                                    <% var acumulado=0;%>

                                        <% for(var j=0; j < MascotaRender[i].MascotasMetas.MetasDonaciones.length; j++)
                                            { %>
                                            <!-- <%= MascotaRender[i].MascotasMetas.MetasDonaciones[j].Cantidad; %> -->

                                            <% acumulado=acumulado+
                                                MascotaRender[i].MascotasMetas.MetasDonaciones[j].Cantidad; %>

                                                <% }%>

                                                    <% var progreso=(acumulado * 100) /
                                                        MascotaRender[i].MascotasMetas.Cantidad;%>
                                                        <!-- <%= progreso%> -->
                                                        <% }%>



                                                            <% if(MascotaRender[i].MascotasMetas !=null &&
                                                                progreso<100){ %>
                                                                <h5 style="text-align: center;">

                                                                    <a href="/petco/publicacion/meta/<%=MascotaRender[i].ID%>"
                                                                        class="btn btn-primary btn-block mt-3">

                                                                        Donar<i
                                                                            class="fa-solid fa-hand-holding-dollar"></i>


                                                                        </i>
                                                                    </a>
                                                                </h5>
                                                                <% }%>
                            </div>

                            <div class="col" style="border:1px solid #cecece; text-align: left;">
                                <div class="container mt-2" style="padding: 3%; overflow-y: scroll; height: 400px;">
                                    
                                    <% if(MascotaRender[i].MascotasMetas !=null){ %>
                                        
            
                                                <div class="progress mb-2">
                                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: <%= progreso%>%;"
                                                        aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                
                                            
                                            <% } %>
            


                                    <% if(MascotaRender[i].MascotasMetas !=null){ %>
                                        <div class="alert alert-dismissible alert-success">
                                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                            <strong>Â¡Esta mascota tiene una meta de <%=
                                                    MascotaRender[i].MascotasMetas.Cantidad%>$!</strong> <br>
                                            <%= MascotaRender[i].MascotasMetas.Descripcion%>.
                                                <br> Se tiene recaudado un <%= progreso%>%
                                        </div>
                                        <% }%>
                                            <h5><b>Nombre:</b>
                                                <%= MascotaRender[i].Nombre%>
                                            </h5>

                                            <h5><b>Edad:</b>
                                                <%= MascotaRender[i].Edad%>
                                            </h5>
                                            <h5><b>Descripcion:</b>
                                                <%= MascotaRender[i].Descripcion%>
                                            </h5>
                                            <% if(MascotaRender[i].MascotasEstado.ID==2 ||
                                                MascotaRender[i].MascotasEstado.ID==3){ %>
                                                <h5 class="text-warning"><b>Estado:</b>
                                                    <%= MascotaRender[i].MascotasEstado.Estado_Nombre%>
                                                </h5>
                                                <% } else{ %>


                                                    <% if(MascotaRender[i].MascotasEstado.ID==1){ %>
                                                        <h5 class="text-success"><b>Estado:</b>
                                                            <%= MascotaRender[i].MascotasEstado.Estado_Nombre%>
                                                        </h5>
                                                        <% } else{ %>

                                                            <h5 class="text-danger"><b>Estado:</b>
                                                                <%= MascotaRender[i].MascotasEstado.Estado_Nombre%>
                                                            </h5>


                                                            <% } %>



                                                                <% } %>
                                                                    <h5><b>Especie:</b>
                                                                        <%=
                                                                            MascotaRender[i].MascotasEspecie.Nombre_Especie%>
                                                                    </h5>
                                                                    <h5><b>Salud:</b>
                                                                        <%= MascotaRender[i].MascotasSalud.Salud%>
                                                                    </h5>
                                                                    <h5><b>TamaÃ±o:</b>
                                                                        <%= MascotaRender[i].MascotasTamano.Tamano%>
                                                                    </h5>
                                                                    <h5><b>Castramiento:</b>
                                                                        <%= MascotaRender[i].MascotasCastrado.Castrado%>
                                                                    </h5>
                                                                    <h5><b>Vacunas:</b>
                                                                        <% for(var j=0; j <
                                                                            MascotaRender[i].MascotasVacunas.length;
                                                                            j++) { %>
                                                                            <%=
                                                                                MascotaRender[i].MascotasVacunas[j].Nombre_Vacuna%>
                                                                                <% if(j
                                                                                    !=MascotaRender[i].MascotasVacunas.length-1){
                                                                                    %>,<% }else{ %>
                                                                                        <% } %>
                                                                                            <% } %>
                                                                    </h5>


                                                                    <h5 style="text-align: center;" class="mt-5">

                                                                        <a href="/petco/formulario/responder/m=<%=MascotaRender[i].ID%>"
                                                                            class="btn btn-warning btn-block">


                                                                            Enviar solicitud <i
                                                                                class="fa-solid fa-envelope"></i>

                                                                            </i>
                                                                        </a>
                                                                    </h5>


                                </div>
                            </div>

                      
                        </div>


    

                    </div>


                    <% } %>

            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next MascotaNext"></div>
            <div class="swiper-button-prev MacotaPrev"></div>

            
        </div>
        

        <button id="like">
            <i class="fa-regular fa-heart fa-2x IconToLike" style="color:#EA2340; display: none;"></i>    
            <i class="fa-solid fa-heart fa-2x IconLiked"  style="color:#EA2340; display: block;" ></i>
        </button>
       
        <!-- <i class="fa-solid fa-heart fa-2x" style="color:#EA2340"></i> -->
        <div class="row">
            <div class="w-100"></div>
                        <div class="col" style="border:1px solid #cecece;">
                        </div>
        </div>


        <div class="container mt-3 mb-5" style="padding: 0%;">

            <div class="row d-flex justify-content-center">
                <div class="">
                    <div class="card shadow-0 border">
                        <div class="card-body p-4">

                            <form id="form" action="">
                                <input class="form-control mt-3 mb-3" id="input" autocomplete="off"
                                    placeholder="Escribe un comentario" />
                            </form>

                            <div class="card mb-4 comentarioTemplate" style="display: none;" >
                                <div class="card-body">
                                    <p style="text-align: left;" class="contenido">Aqui va un comentario</p>

                                    <div class="">
                                        <div class="d-flex flex-row align-items-center">
                                            <img class="imagenusuario"
                                                src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(4).webp"
                                                alt="avatar" width="25" height="25" />
                                            <p class="small mb-0 ms-2 nombreusuario">Usuario Nombre</p>
                                            <span class="text-muted fechahecho">-2 hours ago</span>
                                        </div>
                                        <div class="">
                                            <form id="comentario-1" action="">
                                                <input class="form-control mt-3 mb-3" id="input" autocomplete="off"
                                                    placeholder="Responder" />
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recibir los comentarios de la base de datos -->
                            <div class="list-group comentarios">
                                <% for(var i=0; i < comentarios.length; i++) { %>
                                    <div class="card mb-4 comentarioTemplate" style= " display: <%=comentarios[i].Comentario_Padre== null ? 'block' : 'none' %>;  max-width: 1244px; max-height: 423px"   >
                                        
                                        <div class="card-body">
                                            <p style="text-align: left;" class="contenido">
                                                <%= comentarios[i].Texto%>
                                            </p>
                                            <div class="">
                                                <div class="d-flex flex-row align-items-center">
                                                    <img class="imagenusuario"
                                                        src="<%= comentarios[i].ComentariosUsuario.Foto_Perfil%>"
                                                        alt="avatar" width="25" height="25" />
                                                    <p class="small mb-0 ms-2 nombreusuario">
                                                        <%= comentarios[i].ComentariosUsuario.UsuarioRegistro.Nombre%>
                                                    </p>
                                                    <span class="text-muted fechahecho">â€”
                                                        
                                                        <% var FechaFormateada = comentarios[i].Fecha_Envio.toString()%>
                                                        
                                                        <%var myDate = new Date(FechaFormateada); %>

                                                        <%=    myDate.getFullYear() + '-' +  myDate.getMonth() +  '-' + myDate.getDate() +' ' +myDate.getHours() + ':' +myDate.getMinutes()  + ':' +myDate.getSeconds()   %>
                                                    
                                                    </span>
                                                </div>
                                                <div class="">
                                                    <form id="comentarioForm-<%=comentarios[i].ID%>" action="">
                                                        <input class="form-control mt-3 mb-3"
                                                            id="inputC-<%=comentarios[i].ID%>" autocomplete="off"
                                                            placeholder="Responder" />
                                                    </form>
                                                </div>
                                            </div>

                                            <div class="list-group respuestas" id="comentario-<%=comentarios[i].ID%>">
                                                <% for(var j=0; j < comentarios.length; j++) { %>
    
                                                    <%if (comentarios[j].Comentario_Padre == comentarios[i].ID ) { %>
                                                        <!-- Se ponen las respuestas --> 
                               
    
    
                                                        <div class="card mb-4 respuestaTemplate" style="display: block;">
                                                                    
                                                            <div class="card-body">
                                                                <p style="text-align: left;" class="contenido">
                                                                    <%= comentarios[j].Texto%>
                                                                </p>
                    
                                                                <div class="">
                                                                    <div class="d-flex flex-row align-items-center">
                                                                        <img class="imagenusuario"
                                                                            src="<%= comentarios[j].ComentariosUsuario.Foto_Perfil%>"
                                                                            alt="avatar" width="25" height="25" />
                                                                        <p class="small mb-0 ms-2 nombreusuario">
                                                                            <%= comentarios[j].ComentariosUsuario.UsuarioRegistro.Nombre%>
                                                                        </p>
                                                                        <span class="text-muted fechahecho">â€”
                                                                            
                                                                            <% var FechaFormateada = comentarios[j].Fecha_Envio.toString()%>
                                                                            
                                                                            <%var myDate = new Date(FechaFormateada); %>
                    
                                                                            <%=    myDate.getFullYear() + '-' +  myDate.getMonth() +  '-' + myDate.getDate() +' ' +myDate.getHours() + ':' +myDate.getMinutes()  + ':' +myDate.getSeconds()   %>
                                                                        
                                                                        </span>
                                                                    </div>
                                                
                                                                </div>
                    
                                                            
                                                            </div>
                                                        </div>
                                                        
                                                        <% } %>
                                                        <% } %>                
                                                        
                                                </div>
                                            
                            
                                        </div>
                                        </div>
                                        <% } %>

                                    </div>     
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
    var idSession = '<%= usuario[0].ID%>';
    var idPublicacion = <%=MascotaRender[0].MascotasPublicacion.ID %>;
    var nombreuser = '<%= usuario[0].Nombre%>';
    var imagenperfil = ' <%= usuario[0].RegistroUsuario.Foto_Perfil%>';
    //Script para respuestas
    var ncomentarios = <%=comentarios.length%>;
    const comentariosJS = <%-JSON.stringify(comentarios)%>;
    console.log("ðŸš€ ~ file: publicacion.ejs ~ line 357 ~ idPublicacion", idPublicacion)
    </script>

    <script type="module" src="/javascripts/ComentarioSockets.js">
    </script>

     <script type="module" src="/javascripts/LikeScript.js">
        </script>


    <script>

        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
        })

    </script>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

    <!-- Initialize Swiper -->
    <script>
        var swiper = new Swiper(".mySwiper", {
            effect: "cards",
            rewind: true,
            cubeEffect: {
                shadow: true,
                slideShadows: true,
                shadowOffset: 20,
                shadowScale: 0.94,
            },
            pagination: {
                el: ".swiper-pagination",
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
        });

        var swiper = new Swiper(".SliderMascota", {
            effect: "flip",
            rewind: true,
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            navigation: {
                nextEl: ".MascotaNext",
                prevEl: ".MacotaPrev",
            },
        });
    </script>



</body>

</html>